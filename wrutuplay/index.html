<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Playground</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #71b7e6, #9b59b6);
            font-family: Arial, sans-serif;
            margin: 0;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 600px;
            max-width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        textarea {
            width: 100%;
            height: 150px;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            resize: none;
            font-family: monospace;
        }

        button {
            display: block;
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: #9b59b6;
            color: white;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background: #8e44ad;
        }

        .output {
            margin-top: 20px;
            padding: 10px;
            background: #f1f1f1;
            border-radius: 5px;
            min-height: 50px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Playground</h1>
        <textarea id="code" placeholder="Enter your code here..."></textarea>
        <button onclick="executeCode()">Run Code</button>
        <div class="output" id="output"></div>
    </div>

    <script>
        const functions = {};
        const variables = {};
        const running_while = [false];

        class Executor {
            constructor(code) {
                this.code = code;
            }

            execute1() {
                const lines = this.code.split("\n");
                let in_func = [false];
                let endnum = 0;
                let funcname = [""];

                for (let line of lines) {
                    const tokens = line.trim().split(/\s+/);

                    if (tokens.length) {
                        const token = tokens[0];

                        if (!in_func[0]) {
                            if (token === "fnc") {
                                funcname[0] = tokens[1];
                                if (tokens[2] === "[") {
                                    endnum += 1;
                                    in_func[0] = true;
                                    functions[funcname[0]] = [];
                                }
                            } else if (token === "&&" || token === "") {
                                continue;
                            } else {
                                this.printError("You can only create functions outside of a function");
                                return;
                            }
                        } else {
                            if (token === "if" || token === "while") {
                                endnum += 1;
                                functions[funcname[0]].push(line);
                            } else if (token === "]") {
                                if (endnum > 0) {
                                    endnum -= 1;
                                    functions[funcname[0]].push(line);
                                } else {
                                    in_func[0] = false;
                                    endnum = 0;
                                    functions[funcname[0]].pop();
                                }
                            } else {
                                functions[funcname[0]].push(line);
                            }
                        }
                    }
                }
                new Executor(functions["main"].join("\n")).execute2();
            }

            execute2() {
                const lines = this.code.split("\n");
                let in_if = [false];
                let varname1 = [""];
                let operation = [""];
                let varname2 = [""];
                let ifcode = [];
                let endnum = 0;
                let in_while = [false];
                let while_code = [];

                for (let line of lines) {
                    const tokens = line.trim().split(/\s+/);

                    if (tokens.length) {
                        const token = tokens[0];

                        if (!in_if[0] && !in_while[0]) {
                            this.executeCommand(token, tokens);
                        } else if (in_if[0]) {
                            if (token === "if" || token === "while") {
                                endnum += 1;
                                ifcode.push(line);
                            } else if (token === "]") {
                                if (endnum > 0) {
                                    endnum -= 1;
                                    ifcode.push(line);
                                } else {
                                    in_if[0] = false;
                                    endnum = 0;
                                    ifcode.pop();
                                    this.evaluateCondition(varname1[0], operation[0], varname2[0], ifcode);
                                }
                            } else {
                                ifcode.push(line);
                            }
                        } else if (in_while[0]) {
                            if (token === "if" || token === "while") {
                                endnum += 1;
                                while_code.push(line);
                            } else if (token === "]") {
                                if (endnum > 0) {
                                    endnum -= 1;
                                    while_code.push(line);
                                } else {
                                    in_while[0] = false;
                                    endnum = 0;
                                    while_code.pop();
                                    while (running_while[0]) {
                                        new Executor(while_code.join("\n")).execute2();
                                    }
                                }
                            } else {
                                while_code.push(line);
                            }
                        }
                    }
                }
            }

            executeCommand(token, tokens) {
                const outputElement = document.getElementById('output');
                switch (token) {
                    case "showln":
                        this.showln(tokens, outputElement);
                        break;
                    case "int":
                        this.declareVariable(tokens, "int");
                        break;
                    case "string":
                        this.declareVariable(tokens, "string");
                        break;
                    case "call":
                        this.callFunction(tokens[1]);
                        break;
                    case "if":
                        this.startIfBlock(tokens);
                        break;
                    case "bool":
                        this.declareVariable(tokens, "bool");
                        break;
                    case "while":
                        this.startWhileBlock(tokens);
                        break;
                    case "stop":
                        running_while[0] = false;
                        break;
                    case "mod":
                        this.modifyVariable(tokens);
                        break;
                    case "input":
                        this.inputVariable(tokens);
                        break;
                    case "float":
                        this.declareVariable(tokens, "float");
                        break;
                    case "rand":
                        this.generateRandom(tokens);
                        break;
                    case "list":
                        variables[tokens[1]] = [];
                        break;
                    case "listapp":
                        variables[tokens[1]].push(variables[tokens[2]]);
                        break;
                    case "listpop":
                        variables[tokens[1]].pop();
                        break;
                    case "getlistitem":
                        this.getListItem(tokens);
                        break;
                    case "split":
                        variables[tokens[2]] = variables[tokens[1]].split();
                        break;
                    case "&&":
                    case "":
                        break;
                    default:
                        this.printError(`Unknown token: ${token}`);
                }
            }

            showln(tokens, outputElement) {
                if (tokens[1] === "\"") {
                    if (tokens[tokens.length - 1] === "\"") {
                        const msg = tokens.slice(2, tokens.length - 1).join(" ");
                        outputElement.innerText += msg;
                    } else {
                        this.printError("Use \" to close a string");
                    }
                } else if (tokens[1] === "\\n") {
                    outputElement.innerText += "\n";
                } else if (tokens[1] === "\\spc") {
                    outputElement.innerText += " ";
                } else {
                    outputElement.innerText += variables[tokens[1]] ?? '';
                }
            }

            declareVariable(tokens, type) {
                const varname = tokens[1];
                if (tokens[2] === ":") {
                    let value;
                    if (type === "int") {
                        value = parseInt(tokens[3], 10);
                    } else if (type === "string") {
                        value = tokens.slice(3).join(" ");
                    } else if (type === "bool") {
                        value = tokens[3] === "ok" ? 1 : 0;
                    } else if (type === "float") {
                        value = parseFloat(tokens[3]);
                    }
                    variables[varname] = value;
                } else {
                    this.printError("Use : to assign a value to a variable");
                }
            }

            callFunction(funcname) {
                new Executor(functions[funcname].join("\n")).execute2();
            }

            startIfBlock(tokens) {
                varname1[0] = tokens[1];
                operation[0] = tokens[2];
                if (tokens.length === 5) {
                    varname2[0] = tokens[3];
                    if (tokens[4] === "[") {
                        in_if[0] = true;
                        endnum += 1;
                        ifcode = [];
                    }
                } else {
                    if (operation[0] === "[") {
                        in_if[0] = true;
                        endnum += 1;
                        ifcode = [];
                    }
                }
            }

            startWhileBlock(tokens) {
                if (tokens[1] === "[") {
                    in_while[0] = true;
                    while_code = [];
                    endnum += 1;
                    running_while[0] = true;
                } else {
                    this.printError("Use [ to open a while loop");
                }
            }

            modifyVariable(tokens) {
                const varname1 = tokens[1];
                if (tokens[2] === "<") {
                    const varname2 = tokens[3];
                    variables[varname1] += variables[varname2];
                } else {
                    this.printError("Use < to modify the second var to the first var");
                }
            }

            inputVariable(tokens) {
                const inptype = tokens[1];
                const varname = tokens[2];
                const value = prompt(`Enter a ${inptype}:`);
                if (inptype === "int") {
                    variables[varname] = parseInt(value, 10);
                } else if (inptype === "string") {
                    variables[varname] = value;
                }
            }

            generateRandom(tokens) {
                let varname1 = tokens[1];
                let varname2 = tokens[2];
                if (varname1.match(/^\d+$/)) {
                    varname1 = parseInt(varname1, 10);
                } else {
                    varname1 = variables[varname1];
                }
                if (varname2.match(/^\d+$/)) {
                    varname2 = parseInt(varname2, 10);
                } else {
                    varname2 = variables[varname2];
                }
                const outputvar = tokens[3];
                variables[outputvar] = Math.floor(Math.random() * (varname2 - varname1 + 1)) + varname1;
            }

            getListItem(tokens) {
                const listvarname = tokens[1];
                const itempos = tokens[2];
                if (tokens[3] === ">") {
                    const outputvar = tokens[4];
                    const index = itempos.match(/^\d+$/) ? parseInt(itempos, 10) : variables[itempos];
                    variables[outputvar] = variables[listvarname][index];
                } else {
                    this.printError("Use > to reference the output var");
                }
            }

            evaluateCondition(varname1, operation, varname2, ifcode) {
                const value1 = variables[varname1];
                const value2 = variables[varname2];
                let conditionMet = false;

                switch (operation) {
                    case "=":
                        conditionMet = value1 === value2;
                        break;
                    case "!":
                        conditionMet = value1 !== value2;
                        break;
                    case ">>":
                        conditionMet = value1 >= value2;
                        break;
                    case "<<":
                        conditionMet = value1 <= value2;
                        break;
                    case ">":
                        conditionMet = value1 > value2;
                        break;
                    case "<":
                        conditionMet = value1 < value2;
                        break;
                    case "[":
                        conditionMet = Boolean(value1);
                        break;
                    default:
                        this.printError(`Unknown operation: ${operation}`);
                }

                if (conditionMet) {
                    new Executor(ifcode.join("\n")).execute2();
                }
            }

            printError(message) {
                const outputElement = document.getElementById('output');
                outputElement.innerText += `Error: ${message}\n`;
            }
        }

        function executeCode() {
            const code = document.getElementById('code').value;
            const outputElement = document.getElementById('output');
            outputElement.innerText = '';
            new Executor(code).execute1();
        }
    </script>
</body>
</html>
